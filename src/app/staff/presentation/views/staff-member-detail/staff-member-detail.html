<app-layout-nursing-home>
  <h1 class="title">{{ 'staff-management.detail.title' | translate }}</h1>

  <div class="detail-container">

    @if (store.loading()) {
      <div class="loading-wrapper">
        <mat-spinner diameter="50"></mat-spinner>
        <p>{{ 'staff-management.loading' | translate }}</p>
      </div>
    }

    @if (store.error()) {
      <mat-error class="error-message">
        <mat-icon>error</mat-icon>
        {{ store.error() }}
      </mat-error>
    }

    @if (staffMember()) {

      <!-- Botón Volver arriba -->
      <div class="top-actions">
        <button mat-raised-button
                color="accent"
                (click)="goBack()">
          <mat-icon>arrow_back</mat-icon>
          {{ 'staff-management.buttons.go-back' | translate }}
        </button>
      </div>

      <div class="detail-layout">

        <!-- Header Card -->
        <mat-card class="header-card">
          <div class="header-content">
            <div class="photo-section">
              <div class="photo-wrapper">
                <div class="photo-frame">
                  <img [src]="staffMember()!.image"
                       (load)="onImageLoad(staffMember()!.id)"
                       (error)="onImageError($event, staffMember()!.id)"
                       [alt]="staffMember()!.name + ' ' + staffMember()!.lastname"
                       [class.loaded]="imageLoadedMap[staffMember()!.id]">
                </div>
                <div class="photo-badge">
                  <mat-icon>verified</mat-icon>
                </div>
              </div>
            </div>

            <div class="main-info">
              <div class="name-section">
                <h1 class="staff-name">
                  {{ staffMember()!.name }} {{ staffMember()!.lastname }}
                </h1>
                <mat-chip [class.chip-active]="staffMember()!.state === 'Active'"
                          [class.chip-inactive]="staffMember()!.state !== 'Active'">
                  <div class="status">
                    <mat-icon class>
                      {{ staffMember()!.state === 'Active' ? 'check_circle' : 'cancel' }}
                    </mat-icon>
                    {{ staffMember()!.state }}
                  </div>
                </mat-chip>
              </div>

              <div class="quick-info">
                <div class="info-item">
                  <mat-icon>badge</mat-icon>
                  <div>
                    <span class="info-label">{{ 'staff-management.dni' | translate }}</span>
                    <span class="info-value">{{ staffMember()!.dni }}</span>
                  </div>
                </div>
                <div class="info-item">
                  <mat-icon>work</mat-icon>
                  <div>
                    <span class="info-label">{{ 'staff-management.post' | translate }}</span>
                    <span class="info-value">{{ staffMember()!.post }}</span>
                  </div>
                </div>
                <div class="info-item">
                  <mat-icon>schedule</mat-icon>
                  <div>
                    <span class="info-label">{{ 'staff-management.type-of-contract' | translate }}</span>
                    <span class="info-value">{{ staffMember()!.workShift }}</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <mat-divider></mat-divider>
          <div class="card-actions">
            <button mat-raised-button color="accent" (click)="viewEmploymentRecord()" class="action-btn">
              <mat-icon>folder_shared</mat-icon>
              {{ 'staff-management.record' | translate }}
            </button>
          </div>
        </mat-card>

        <!-- Sección: Información Personal -->
        <div class="section-title">
          <mat-icon>person</mat-icon>
          <h2>{{ 'staff-management.basic-info' | translate }}</h2>
        </div>

        <div class="info-grid">
          <mat-card class="info-card">
            <div class="card-header-custom">
              <div class="icon-wrapper personal">
                <mat-icon>person</mat-icon>
              </div>
              <h3>{{ 'staff-management.personal-info' | translate }}</h3>
            </div>
            <div class="card-body">
              <div class="detail-row">
                <div class="detail-label">
                  <mat-icon>badge</mat-icon>
                  {{ 'staff-management.dni' | translate }}
                </div>
                <div class="detail-value">{{ staffMember()!.dni }}</div>
              </div>
              <mat-divider></mat-divider>
              <div class="detail-row">
                <div class="detail-label">
                  <mat-icon>cake</mat-icon>
                  {{ 'staff-management.birthDate' | translate }}
                </div>
                <div class="detail-value">{{ staffMember()!.birthDate | date:'dd/MM/yyyy' }}</div>
              </div>
              <mat-divider></mat-divider>
              <div class="detail-row">
                <div class="detail-label">
                  <mat-icon>calendar_today</mat-icon>
                  {{ 'staff-management.age' | translate }}
                </div>
                <div class="detail-value">{{ staffMember()!.age }} años</div>
              </div>
              @if (staffMember()!.nationality) {
                <mat-divider></mat-divider>
                <div class="detail-row">
                  <div class="detail-label">
                    <mat-icon>flag</mat-icon>
                    {{ 'staff-management.nationality' | translate }}
                  </div>
                  <div class="detail-value">{{ staffMember()!.nationality }}</div>
                </div>
              }
            </div>
          </mat-card>

          <mat-card class="info-card">
            <div class="card-header-custom">
              <div class="icon-wrapper contact">
                <mat-icon>contact_phone</mat-icon>
              </div>
              <h3>{{ 'staff-management.contact-info' | translate }}</h3>
            </div>
            <div class="card-body">
              <div class="detail-row">
                <div class="detail-label">
                  <mat-icon>phone</mat-icon>
                  {{ 'staff-management.phone' | translate }}
                </div>
                <div class="detail-value">{{ staffMember()!.phoneNumber }}</div>
              </div>
              <mat-divider></mat-divider>
              <div class="detail-row">
                <div class="detail-label">
                  <mat-icon>email</mat-icon>
                  {{ 'staff-management.email' | translate }}
                </div>
                <div class="detail-value email-value">{{ staffMember()!.email }}</div>
              </div>
              <mat-divider></mat-divider>
              <div class="detail-row">
                <div class="detail-label">
                  <mat-icon>home</mat-icon>
                  {{ 'staff-management.address' | translate }}
                </div>
                <div class="detail-value">{{ staffMember()!.address }}</div>
              </div>
            </div>
          </mat-card>
        </div>

        <!-- Sección: Información Laboral -->
        <div class="section-title">
          <mat-icon>work</mat-icon>
          <h2>{{ 'staff-management.employment-info' | translate }}</h2>
        </div>

        <div class="info-grid">
          <mat-card class="info-card">
            <div class="card-header-custom">
              <div class="icon-wrapper employment">
                <mat-icon>badge</mat-icon>
              </div>
              <h3>{{ 'staff-management.position-contract' | translate }}</h3>
            </div>
            <div class="card-body">
              <div class="detail-row">
                <div class="detail-label">
                  <mat-icon>work_outline</mat-icon>
                  {{ 'staff-management.position' | translate }}
                </div>
                <div class="detail-value post-badge">
                  <mat-icon>work</mat-icon>
                  {{ staffMember()!.post }}
                </div>
              </div>
              <mat-divider></mat-divider>
              <div class="detail-row">
                <div class="detail-label">
                  <mat-icon>description</mat-icon>
                  {{ 'staff-management.type-of-contract' | translate }}
                </div>
                <div class="detail-value">{{ staffMember()!.typeOfContract }}</div>
              </div>
              <mat-divider></mat-divider>
              <div class="detail-row">
                <div class="detail-label">
                  <mat-icon>schedule</mat-icon>
                  {{ 'staff-management.work-shift' | translate }}
                </div>
                <div class="detail-value shift-badge">
                  {{ staffMember()!.workShift }}
                </div>
              </div>
            </div>
          </mat-card>

          <mat-card class="info-card">
            <div class="card-header-custom">
              <div class="icon-wrapper employment">
                <mat-icon>event</mat-icon>
              </div>
              <h3>{{ 'staff-management.contractual-date' | translate }}</h3>
            </div>
            <div class="card-body">
              <div class="detail-row">
                <div class="detail-label">
                  <mat-icon>login</mat-icon>
                  {{ 'staff-management.contract-date' | translate }}
                </div>
                <div class="detail-value">{{ staffMember()!.contractDate | date:'dd/MM/yyyy' }}</div>
              </div>
              @if (staffMember()!.contractEndDate) {
                <mat-divider></mat-divider>
                <div class="detail-row">
                  <div class="detail-label">
                    <mat-icon>logout</mat-icon>
                    {{ 'staff-management.contract-end-date' | translate }}
                  </div>
                  <div class="detail-value">{{ staffMember()!.contractEndDate | date:'dd/MM/yyyy' }}</div>
                </div>
              }
              @if (staffMember()!.terminationDate) {
                <mat-divider></mat-divider>
                <div class="detail-row">
                  <div class="detail-label">
                    <mat-icon>event_busy</mat-icon>
                    {{ 'staff-management.termination-date' | translate }}
                  </div>
                  <div class="detail-value termination-date">{{ staffMember()!.terminationDate | date:'dd/MM/yyyy' }}</div>
                </div>
              }
            </div>
          </mat-card>
        </div>

        <!-- Sección: Información Profesional -->
        @if (staffMember()!.certifications && staffMember()!.certifications.length > 0) {
          <div class="section-title">
            <mat-icon>school</mat-icon>
            <h2>{{ 'staff-management.professional-info' | translate }}</h2>
          </div>

          <mat-card class="full-width-card">
            <div class="card-header-custom">
              <div class="icon-wrapper professional">
                <mat-icon>workspace_premium</mat-icon>
              </div>
              <h3>{{ 'staff-management.certifications' | translate }}</h3>
            </div>
            <div class="card-body">
              <div class="chips-container">
                @for (certification of staffMember()!.certifications; track certification) {
                  <mat-chip class="certification-chip">
                    <mat-icon>verified</mat-icon>
                    {{ certification }}
                  </mat-chip>
                }
              </div>
            </div>
          </mat-card>
        }

        <!-- Sección: Contactos de Emergencia -->
        <div class="section-title">
          <mat-icon>emergency</mat-icon>
          <h2>{{ 'staff-management.emergency-contacts' | translate }}</h2>
        </div>

        <div class="info-grid">
          <mat-card class="info-card">
            <div class="card-header-custom">
              <div class="icon-wrapper emergency">
                <mat-icon>contact_emergency</mat-icon>
              </div>
              <h3>{{ 'staff-management.emergency-contact' | translate }}</h3>
            </div>
            <div class="card-body">
              <div class="detail-row">
                <div class="detail-label">
                  <mat-icon>person</mat-icon>
                  {{ 'staff-management.emergencyContactName' | translate }}
                </div>
                <div class="detail-value">{{ staffMember()!.emergencyContactName }}</div>
              </div>
              <mat-divider></mat-divider>
              <div class="detail-row">
                <div class="detail-label">
                  <mat-icon>phone</mat-icon>
                  {{ 'staff-management.emergencyContactPhone' | translate }}
                </div>
                <div class="detail-value">{{ staffMember()!.emergencyContactPhone }}</div>
              </div>
            </div>
          </mat-card>
        </div>

        <!-- Tarjeta Expediente Laboral -->
        <mat-card class="records-card">
          <div class="records-content">
            <div class="records-icon-wrapper">
              <mat-icon>folder_shared</mat-icon>
            </div>
            <div class="records-text">
              <h3>{{ 'staff-management.record' | translate }}</h3>
              <p>
                {{ 'staff-management.record-info' | translate }}
              </p>
            </div>
            <button mat-fab
                    color="accent"
                    (click)="viewEmploymentRecord()"
                    class="records-fab">
              <mat-icon>arrow_forward</mat-icon>
            </button>
          </div>
        </mat-card>
      </div>
    } @else {
      <div class="not-found">
        <div class="not-found-icon-wrapper">
          <mat-icon class="not-found-icon">person_off</mat-icon>
        </div>
        <h2>{{ 'staff-management.error.not-found' | translate }}</h2>
        <p>{{ 'staff-management.error.not-found-message' | translate }}</p>
        <button mat-raised-button color="primary" (click)="goBack()">
          <mat-icon>arrow_back</mat-icon>
          {{ 'staff-management.buttons.back-to-list' | translate }}
        </button>
      </div>
    }
  </div>

  <div class="action-buttons">
    <button mat-raised-button
            color="accent"
            (click)="goBack()">
      <mat-icon>arrow_back</mat-icon>
      {{ 'staff-management.buttons.go-back' | translate }}
    </button>

    <button mat-raised-button
            color="warn"
            (click)="deleteStaffMember()">
      <mat-icon>delete</mat-icon>
      {{ 'staff-management.buttons.delete' | translate }}
    </button>

    <button mat-raised-button
            color="primary"
            (click)="editStaffMember()">
      <mat-icon>edit</mat-icon>
      {{ 'staff-management.buttons.edit' | translate }}
    </button>
  </div>
</app-layout-nursing-home>
